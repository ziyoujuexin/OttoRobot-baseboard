<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Servo Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .form-container { margin-top: 50px; }
        input { margin: 5px; padding: 8px; width: 100px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>Servo Controller</h1>
    <div class="form-container">
        <form id="servoForm">
            <label for="channel">Channel (0-15):</label>
            <input type="number" id="channel" name="channel" min="0" max="15" required>
            <br>
            <label for="angle">Angle (0-180):</label>
            <input type="number" id="angle" name="angle" min="0" max="180" required>
            <br><br>
            <button type="submit">Set Angle</button>
        </form>
        <p id="status"></p>
    </div>

    <script>
        document.getElementById('servoForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 阻止表单默认的刷新页面的提交行为
            
            const channel = document.getElementById('channel').value;
            const angle = document.getElementById('angle').value;
            const statusEl = document.getElementById('status');

            statusEl.textContent = 'Sending...';

            // 使用 fetch API 发送 GET 请求
            fetch(`/api/servo?channel=${channel}&angle=${angle}`)
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    statusEl.textContent = `Success: ${data}`;
                })
                .catch(error => {
                    statusEl.textContent = `Error: ${error.message}`;
                });
        });
    </script>

    <hr style="margin-top: 40px;">

    <div class="form-container">
        <h2>Generic Command Sender</h2>
        <form id="commandForm">
            <label for="motion_type">Motion Type (number):</label>
            <input type="number" id="motion_type" name="motion_type" min="0" max="255" required>
            <br>
            <label for="param">Parameter (number):</label>
            <input type="number" id="param" name="param" min="0" max="255" required>
            <br><br>
            <button type="submit">Queue Command</button>
        </form>
        <p id="commandStatus"></p>
    </div>

    <script>
        document.getElementById('commandForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const motion_type = document.getElementById('motion_type').value;
            const param = document.getElementById('param').value;
            const statusEl = document.getElementById('commandStatus');

            statusEl.textContent = 'Sending command...';

            fetch(`/api/command?type=${motion_type}&param=${param}`)
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    statusEl.textContent = `Success: ${data}`;
                })
                .catch(error => {
                    statusEl.textContent = `Error: ${error.message}`;
                });
        });
    </script>
</body>
</html>